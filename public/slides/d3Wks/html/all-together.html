<style>

    #all-together .code {
        font-size: 1.5em;
    }

    #all-together svg {
        border: solid;
        margin: 1em;
    }

    #all-together circle {
        fill: white;
        stroke: black;
        stroke-width: 2px;
        opacity: .5;
    }

</style>

<div class="row">
    <div class="col s6">
    </div>
    <div class="col s6">
    </div>
</div>

<div class="screencontainer">
    <div class="screenposition screenright screenbottom">
        <a class="runcode btn-floating btn waves-effect waves-light blue stdmargin"><i class="material-icons">play_arrow</i></a>
        <svg id="svg01" height="300" width="300">
        </svg>
    </div>
</div>

<div class="code2 code"></div>
<div class="code1 code"></div>

<script>

    /* global slidAR */

    (function () {
        const ID = "all-together";

        const codeSelector1 = "#" + ID + " .code1";
        const codeSelector2 = "#" + ID + " .code2";

        const fullSvgCode = "<svg id=\"svg01\" height=\"300\" width=\"300\">\n" +
            "</svg>";
        const codeOptions = {noBackgroundColor: true};

        gapslides.showCode2.bash(codeSelector2, fullSvgCode, codeOptions);

        gapslides.showCode2.js(codeSelector1,
            "function render(data) {\n" +
            "   const selection = svg.selectAll(\"circle\")\n" +
            "       .data(data, function (d) {\n" +
            "           return d.name;\n" +
            "       });\n" +
            "\n" +
            "   selection.enter()\n" +
            "       .append(\"circle\")\n" +
            "       .attr(\"cx\", 150)\n" +
            "       .attr(\"cy\", 150)\n" +
            "       .attr(\"r\", 10)\n" +
            "       .merge(selection)\n" +
            "       .transition()\n" +
            "       .duration(1000)\n" +
            "       .attr(\"cx\", function (d) {\n" +
            "           return d.x;\n" +
            "       })\n" +
            "       .attr(\"cy\", function (d) {\n" +
            "           return d.y;\n" +
            "       })\n" +
            "       .attr(\"r\", function (d) {\n" +
            "           return d.r;\n" +
            "       })\n" +
            "       .style(\"fill\", function (d) {\n" +
            "           return d.color;\n" +
            "       })\n" +
            "\n" +
            "   selection.exit()\n" +
            "       .transition()\n" +
            "       .duration(500)\n" +
            "       .attr(\"r\", 0)\n" +
            "       .style(\"opacity\", 0)\n" +
            "       .remove();\n" +
            "\n" +
            "}\n" +
            "\n" +
            "const colorScale = d3.scaleOrdinal(d3.schemeCategory20);\n" +
            "\n" +
            "setInterval(function () {\n" +
            "   const data = [];\n" +
            "\n" +
            "   for(var i = 0; i < 20; i++) {\n" +
            "       if(Math.random() > .1) {\n" +
            "           data.push({\n" +
            "               name: i,\n" +
            "               x: Math.floor(d3.randomUniform(0,300)()),\n" +
            "               y: Math.floor(d3.randomUniform(0,300)()),\n" +
            "               r: Math.floor(d3.randomUniform(0,50)()),\n" +
            "               color: colorScale(i)\n" +
            "           })\n" +
            "       }\n" +
            "   }\n" +
            "\n" +
            "   render(data)\n" +
            "}, 1000)\n"
            , codeOptions);

        const emptySvgCode = "<svg id=\"svg01\" height=\"300\" width=\"300\">\n</svg>";

        const steps = [];
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "1-35"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "1,35"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "2-5"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "7-26"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "7-11"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "12-26"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "28-33"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "37"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "39-55"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "39,55"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "40-54"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "40"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "42-52"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "42,52"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "43-51"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "43,51"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "44-50"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "45"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "46"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "47"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "48"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "49"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, "54"));
        steps.push(gapslides.showCode2.highlightLinesStep(codeSelector1, ""));

        gapslides.steps2.setSteps(ID, steps);

        gapslides.click.setClickHandler(`#${ID} .runcode`, () => {
            const svg = d3.select("#svg01");

            function render(data) {
                const selection = svg.selectAll("circle")
                    .data(data, function (d) {
                        return d.name;
                    });

                selection.enter()
                    .append("circle")
                    .attr("cx", 150)
                    .attr("cy", 150)
                    .attr("r", 10)
                    .merge(selection)
                    .transition()
                    .duration(1000)
                    .attr("cx", function (d) {
                        return d.x;
                    })
                    .attr("cy", function (d) {
                        return d.y;
                    })
                    .attr("r", function (d) {
                        return d.r;
                    })
                    .style("fill", function (d) {
                        return d.color;
                    })

                selection.exit()
                    .transition()
                    .duration(500)
                    .attr("r", 0)
                    .style("opacity", 0)
                    .remove();

            }

            const colorScale = d3.scaleOrdinal(d3.schemeCategory20);

            setInterval(function () {
                const data = [];

                for(var i = 0; i < 20; i++) {
                    if(Math.random() > .1) {
                        data.push({
                            name: i,
                            x: Math.floor(d3.randomUniform(0,300)()),
                            y: Math.floor(d3.randomUniform(0,300)()),
                            r: Math.floor(d3.randomUniform(0,50)()),
                            color: colorScale(i)
                        })
                    }
                }

                render(data)
            }, 1000)
        });

        slidAR.initPhase.markSlideAsReady(ID);
    })()
</script>